> ç¿»è¯‘æ–‡ç« ï¼ŒåŸæ–‡[åœ¨æ­¤](https://micro-frontends.org/)ï¼Œä½œè€…Michael Geers.

## å¾®å‰ç«¯ï¼šæŠŠå¾®æœåŠ¡çš„æ¦‚å¿µæ‰©å±•åˆ°å‰ç«¯å¼€å‘

ç®€ä»‹ï¼šå¾®å‰ç«¯æ˜¯è¿™æ ·çš„æŠ€æœ¯ï¼Œåœ¨å¤šä¸ªå›¢é˜Ÿåä½œæ„å»ºä¸€ä¸ªç°ä»£åŒ–çš„webåº”ç”¨è¿‡ç¨‹ä¸­ï¼Œå®ƒèƒ½å¤Ÿå°†è¿™äº›åº”ç”¨çš„ç‰¹æ€§åˆ’åˆ†å¼€æ¥ï¼Œç‹¬ç«‹å¼€å‘ã€‚

### ä»€ä¹ˆæ˜¯å¾®å‰ç«¯ï¼Ÿ

å¾®å‰ç«¯è¿™ä¸ªæœ¯è¯­æœ€æ—©å‡ºç°åœ¨2016å¹´çš„[ThoughtWorks Technology Radar](https://www.thoughtworks.com/radar/techniques/micro-frontends)ã€‚å®ƒæŠŠå¾®æœåŠ¡çš„æ¦‚å¿µæ‰©å±•åˆ°äº†å‰ç«¯é¢†åŸŸã€‚è¿™ä¸ªæŠ€æœ¯çš„è¶‹åŠ¿æ˜¯æŠŠåŠŸèƒ½ä¸°å¯Œçš„å•é¡µåº”ç”¨æ¶è®¾åˆ°å¾®æœåŠ¡æ¶æ„ä¸Šã€‚åœ¨ä»¥å‰çš„å‰ç«¯å¼€å‘ä¸­ï¼Œé€šå¸¸æ‹†åˆ†å‡ºä¸€ä¸ªç‹¬ç«‹çš„å›¢é˜Ÿæ¥å¼€å‘å’Œç»´æŠ¤é¡µé¢ï¼Œéšç€é¡µé¢åŠŸèƒ½å¢é•¿ï¼Œå·¥ç¨‹ä¹Ÿå˜å¾—è¶Šæ¥è¶Šéš¾ä»¥ç»´æŠ¤ï¼Œæˆ‘ä»¬ç§°è¿™ç§ç°è±¡ä¸º[Frontend Monolith](https://www.youtube.com/watch?v=pU1gXA0rfwc)ï¼ˆå‰ç«¯æ•´ä½“ï¼Œä¸€ä¸ªåº”ç”¨å°±ä¸€ä¸ªå›¢é˜Ÿæ¥å¼€å‘å’Œç»´æŠ¤ï¼Œåº”ç”¨è¶Šå˜è¶Šå¤§ï¼‰ã€‚è€Œå¾®å‰ç«¯çš„æ¦‚å¿µåŸºäºè¿™æ ·çš„æƒ³æ³•ï¼ŒæŠŠé¡µé¢çœ‹æˆæ˜¯ä¸åŒåŠŸèƒ½çš„ç»„åˆï¼Œè€Œè¿™äº›åŠŸèƒ½å¯èƒ½æ¥è‡ªä¸åŒçš„å›¢é˜Ÿã€‚æ¯ä¸ªå›¢é˜Ÿæœ‰è‡ªå·±ä¸“é—¨ç ”ç©¶çš„ä¸šåŠ¡æ–¹å‘ï¼Œæ¯ä¸ªå›¢é˜Ÿéƒ½æ˜¯è·¨ç«¯è¿è¡Œï¼Œå¼€å‘ä»æ•°æ®åº“åˆ°ç”¨æˆ·ç•Œé¢çš„ç‰¹æ€§åŠŸèƒ½ã€‚

ä½†æ˜¯å¾®å‰ç«¯ä¸æ˜¯æ–°çš„æ¦‚å¿µäº†ã€‚å®ƒå’Œ[Self-contained Systems](http://scs-architecture.org/)ï¼ˆè‡ªåŒ…å«ï¼‰ çš„æ¦‚å¿µç›¸ä¼¼ã€‚åˆåƒåœ¨è¿‡å»æ¦‚å¿µä¸­çš„[Frontend Integration for Verticalised Systems](https://dev.otto.de/2014/07/29/scaling-with-microservices-and-vertical-decomposition/)ï¼ˆå‚ç›´ç³»ç»Ÿå‰ç«¯é›†æˆï¼‰ã€‚ä½†æ˜¯å°±ç®—è¿™æ ·ï¼Œå¾®å‰ç«¯ä¹Ÿæ˜¯ä¸€ä¸ªæ›´å‹å¥½ã€æ›´è½»é‡åŒ–çš„æ¦‚å¿µã€‚

**Monolithic Frontends**ï¼ˆå•ä¸€å‰ç«¯ï¼‰

> è¯‘è€…æ³¨ï¼šä¸‹å›¾æ˜¾ç¤ºäº†å½“å‰å‰ç«¯å¼€å‘çš„ä¸‰ä¸ªé˜¶æ®µï¼šæ•´ä½“å¼€å‘ã€å‰åç«¯åˆ†ç¦»ã€å¾®æœåŠ¡

![Monolithic Frontends](microfrontend/monolith-frontback-microservices.png)

**Organisation in Verticals**ï¼ˆå‚ç›´ç»„ç»‡ï¼‰

> è¯‘è€…æ³¨ï¼šé‡‡ç”¨ä¸ºå‰ç«¯çš„ç«¯åˆ°ç«¯å›¢é˜Ÿåä½œå¼€å‘æ–¹å¼

![End-To-End Teams with Micro Frontends](microfrontend/verticals-headline.png)

### ä»€ä¹ˆæ‰ç®—æ˜¯ç°ä»£åŒ–çš„webåº”ç”¨ï¼Ÿ

åœ¨`ç®€ä»‹`ä¸­æˆ‘æåˆ°äº†ä¸€ä¸ªæ¦‚å¿µ`æ„å»ºç°ä»£åŒ–çš„webåº”ç”¨`ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥å®šä¹‰ä¸è¯¥æ¦‚å¿µç›¸å…³çš„ä¸€äº›å‡è®¾ã€‚

ä¸ºäº†æŠŠè¿™ä¸ªæ¦‚å¿µæ”¾åˆ°æ›´å®½å¹¿çš„è§†é‡å†…ï¼Œ[Aral Balkan](https://ar.al/)åœ¨åšå®¢ä¸­å†™äº†ä¸€ç¯‡æ–‡ç« ï¼Œå«[Documentsâ€toâ€Applications Continuum](https://ar.al/notes/the-documents-to-applications-continuum/)ï¼ˆæ–‡æ¡£åˆ°åº”ç”¨çš„è¿ç»­æ€§ï¼‰ï¼Œæ–‡ç« ä¸­ï¼Œä»–æå‡ºäº†æ»‘åŠ¨æ¯”ä¾‹çš„æ¦‚å¿µã€‚

åœ¨ä¸€ä¸ªç½‘ç«™ä¸­ï¼Œç”±é™æ€æ–‡æ¡£åŠ é“¾æ¥çš„æ–¹å¼æ„æˆå·¦è¾¹éƒ¨åˆ†ï¼Œå³è¾¹åˆ™ç”±çº¯ç²¹è¡Œä¸ºé©±åŠ¨çš„æ— å†…å®¹åº”ç”¨æ„æˆï¼Œæ¯”å¦‚ä¸€ä¸ªåœ¨çº¿çš„å›¾ç‰‡ç¼–è¾‘å™¨ã€‚

å¦‚æœä½ æŠŠä½ çš„åº”ç”¨æ”¾åœ¨å·¦ä¾§ï¼Œé‚£ä¹ˆåšä¸€ä¸ªæœåŠ¡å™¨çº§åˆ«çš„æŒç»­é›†æˆæ˜¯ç§å¥½çš„æ¨¡å¼(**æœåŠ¡ç«¯æ¸²æŸ“**)ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼ŒæœåŠ¡å™¨ä»æ‰€æœ‰ç»„ä»¶ä¸­è·å–å­—ç¬¦ä¸²å¹¶æ‹¼æ¥æˆHTMLå­—ç¬¦æ¥ç»„æˆä¸€ä¸ªé¡µé¢è¯·æ±‚çš„å“åº”è¿”å›ç»™ç”¨æˆ·ã€‚é€šè¿‡é‡æ–°ä»æœåŠ¡å™¨åŠ è½½é¡µé¢æˆ–è€…ç”¨ajaxè·å–éƒ¨åˆ†é¡µé¢æ¥å®Œæˆé¡µé¢æ›´æ–°ã€‚ [Gustaf Nilsson Kotte](https://twitter.com/gustaf_nk/) å†™äº†ä¸€ç¯‡æ–‡ç« - [comprehensive article](https://gustafnk.github.io/microservice-websites/) æ¥è§£é‡Šè¿™ç§æ¨¡å¼ã€‚

å½“ä½ çš„ç”¨æˆ·ç•Œé¢å¿…é¡»**å³æ—¶**å¯¹ç”¨æˆ·è¡Œä¸ºåšå‡º**åé¦ˆ**æ—¶ï¼Œå³ä½¿åœ¨ä¸å¯é çš„è¿æ¥ä¸Šï¼Œçº¯æœåŠ¡ç«¯æ¸²æŸ“æ¨¡å¼çš„ç«™ç‚¹ä¹Ÿä¸èƒ½æ»¡è¶³ä½ äº†ã€‚ä¸ºäº†å®ç°[Optimistic UI](https://www.smashingmagazine.com/2016/11/true-lies-of-optimistic-user-interfaces/)ï¼ˆä¹è§‚ç•Œé¢ï¼‰æˆ–è€…[Skeleton Screens](http://www.lukew.com/ff/entry.asp?1797) ï¼ˆéª¨æ¶å±ï¼‰æŠ€æœ¯ï¼Œä½ éœ€è¦è®©åº”ç”¨èƒ½å¤Ÿåœ¨ç”¨æˆ·ç«¯**è‡ªå·±æ›´æ–°è‡ªå·±**ã€‚Googleæ¨å‡ºçš„ [Progressive Web Apps](https://developers.google.com/web/progressive-web-apps/) (æ¸è¿›å¼webåº”ç”¨)çš„æ¦‚å¿µï¼Œæ°åˆ°å¥½å¤„åœ°**å¹³è¡¡**äº†webçš„æ¸è¿›å¢å¼ºç‰¹æ€§å’ŒåŸç”Ÿåº”ç”¨æ€§èƒ½çš„ä½“éªŒã€‚è¿™ç§åº”ç”¨ä»‹äºwebåº”ç”¨å’ŒåŸå£°åº”ç”¨ä¹‹é—´ï¼Œåœ¨æ­¤ï¼Œå®Œå…¨çš„æœåŠ¡ç«¯æ¸²æŸ“æ–¹æ¡ˆå·²ç»ä¸å†é€‚ç”¨äº†ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨**æµè§ˆå™¨ä¸­é›†æˆ**ï¼Œè¿™å°±æ˜¯æœ¬æ–‡æ‰€å…³æ³¨çš„é—®é¢˜ã€‚

### å¾®å‰ç«¯èƒŒåçš„æ ¸å¿ƒè§‚å¿µ

* **Be Technology Agnostic**ä¸å¿…å…³æ³¨(ç»„ä»¶æˆ–åº”ç”¨)å®ç°ç»†èŠ‚

  æ¯ä¸ªå›¢é˜Ÿèƒ½å¤Ÿè‡ªå·±é€‰æ‹©å’Œå‡çº§ä»–ä»¬çš„æŠ€æœ¯æ ˆï¼Œå¹¶ä¸éœ€è¦å’Œå…¶ä»–å›¢é˜ŸååŒå·¥ä½œã€‚[Custom Elements](https://micro-frontends.org/#the-dom-is-the-api)ï¼ˆè‡ªå®šä¹‰å…ƒç´ ï¼‰æ˜¯ä¸€ç§éšè—å®ç°ç»†èŠ‚å¹¶æä¾›ä¸­æ€§æ¥å£çš„å¥½æ–¹æ³•ã€‚

* **Isolate Team Code**éš”ç¦»å›¢é˜Ÿä»£ç 

  ä¸è¦å…±ç”¨åŒä¸€ä¸ªè¿è¡Œç¯å¢ƒï¼Œå³ä½¿æ‰€æœ‰çš„å›¢é˜Ÿéƒ½åœ¨ç”¨åŒæ ·çš„æ¡†æ¶ï¼Œåº”è¯¥æ„å»ºä¸€ä¸ªè‡ªåŒ…å«çš„ç‹¬ç«‹åº”ç”¨ï¼Œä¿è¯ç‹¬ç«‹åº”ç”¨ä¸ä¾èµ–å…±äº«çš„çŠ¶æ€æˆ–è€…å…¨å±€å˜é‡ã€‚

* **solate Team Code**è®¾ç«‹å›¢é˜Ÿå‰ç¼€

  å›¢é˜Ÿé—´åº”è¯¥åœ¨æ— æ³•éš”ç¦»æ—¶ä½¿ç”¨å„è‡ªçš„å‘½åçº¦å®šï¼Œå‘½åç©ºé—´çš„CSSã€äº‹ä»¶ã€æœ¬åœ°å­˜å‚¨ã€Cookieç­‰åº”è¯¥é¿å…å†²çªï¼Œåº”æ¾„æ¸…å„è‡ªå›¢é˜Ÿçš„å‘½åç©ºé—´ã€‚

* **Favor Native Browser Features over Custom APIs**é€šè¿‡å®¢æˆ·ç«¯APIæ¥æ”¯æŒæœ¬åœ°æµè§ˆå™¨ç‰¹æ€§

  ä½¿ç”¨[Browser Events for communication](https://micro-frontends.org/#parent-child-communication--dom-modification)ï¼ˆæµè§ˆå™¨é€šä¿¡äº‹ä»¶ï¼‰ï¼Œä¸è¦ç”¨å…¨å±€çš„è®¢é˜…-å‘å¸ƒç³»ç»Ÿï¼Œå¦‚æœä½ ä¸å¾—ä¸æ„å»ºä¸€ä¸ªè·¨å›¢é˜Ÿçš„APIï¼Œåº”è¯¥å°½é‡è®©å®ƒç®€åŒ–ã€‚

* **Build a Resilient Site**å¼¹æ€§åè¶³çš„ç½‘ç«™

  å³ä½¿jså‡ºé”™æˆ–è€…æ²¡æœ‰è¢«æ‰§è¡Œåˆ°ï¼Œä½ çš„åº”ç”¨ç‰¹æ€§ä¹Ÿåº”è¯¥èƒ½ç”¨ã€‚ä½ å¯ä»¥ä½¿ç”¨[Universal Rendering](https://micro-frontends.org/#serverside-rendering--universal-rendering)ï¼ˆé€šç”¨æ¸²æŸ“ï¼‰å’Œæ¸è¿›å¢å¼ºæ¥æå‡åº”ç”¨è¢«æ„ŸçŸ¥åˆ°çš„æ€§èƒ½ã€‚

### DOMå°±æ˜¯ä½ è¦çš„API

[Custom Elements](https://developers.google.com/web/fundamentals/getting-started/primers/customelements)ï¼ˆè‡ªå®šä¹‰å…ƒç´ ï¼‰æ˜¯å·²ç»é›†æˆåˆ°æµè§ˆå™¨ä¸­çš„webç»„ä»¶äº¤äº’è§„èŒƒã€‚æ¯ä¸ªå›¢é˜Ÿå¯ä»¥**é€‰æ‹©è‡ªå·±çš„æŠ€æœ¯æ¥æ„å»ºç»„ä»¶**ï¼Œæœ€åæŠŠç»„ä»¶åŒ…è£¹åˆ°**è‡ªå®šä¹‰ç»„ä»¶**ä¸­ï¼Œè¿™ä¸ªDOMå…ƒç´ ç»„ä»¶å¯ä»¥è¢«å…¶ä»–å›¢é˜Ÿå¼•ç”¨æˆ–è€…ä½œä¸ºä¸€ä¸ªå…¬å…±çš„APIã€‚è¿™å¸¦æ¥çš„å¥½å¤„å°±æ˜¯æ‰€æœ‰äººå¯ä»¥ç”¨è¿™ä¸ªç»„ä»¶å’Œå®ƒæä¾›çš„åŠŸèƒ½ï¼Œåˆä¸ç”¨å…³å¿ƒå®ƒçš„å®ç°ç»†èŠ‚ã€‚ä½¿ç”¨è€…åªéœ€è¦èƒ½å¤Ÿæ“ä½œå¹¶åº”ç”¨è¿™äº›DOMç»„ä»¶åšäº¤äº’å°±è¡Œäº†ã€‚

ä½†æ˜¯å•ç‹¬ä½¿ç”¨è‡ªå®šä¹‰ç»„ä»¶å¹¶ä¸èƒ½è§£å†³æˆ‘ä»¬æ‰€æœ‰çš„é—®é¢˜ï¼Œä¸ºäº†è§£å†³æ¸è¿›å¢å¼ºã€é€šç”¨æ¸²æŸ“æˆ–è€…è·¯ç”±çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›é¢å¤–çš„è½¯ä»¶æ¥ååŠ©ã€‚

ä»¥ä¸‹æ–‡ç« å°†åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ã€‚ç¬¬ä¸€ä¸ªéƒ¨åˆ†ï¼Œæˆ‘ä»¬è®¨è®º[Page Composition](https://micro-frontends.org/#page-composition)ï¼ˆé¡µé¢ç»„æˆï¼‰-å¦‚ä½•ä»ä¸åŒçš„å›¢é˜Ÿæ„å»ºçš„ç»„ä»¶ä¸­ç¼–è¯‘å‡ºé¡µé¢ã€‚ç¬¬äºŒä¸ªéƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†å±•ç¤ºä¸€äº›å®ç°äº†å®¢æˆ·ç«¯ [Page Transition](https://micro-frontends.org/#page-transition)ï¼ˆé¡µé¢è¿‡æ¸¡ï¼‰çš„ä¾‹å­ã€‚

### é¡µé¢ç»„æˆ

é™¤äº†åœ¨**ä¸åŒæ¡†æ¶ä¸‹ç¼–å†™å‡ºæ¥çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯**æœ¬èº«ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜æœ‰å¾ˆå¤šæ–¹é¢éœ€è¦è®¨è®ºï¼š**jséš”ç¦»æœºåˆ¶**ã€**csså†²çªé¿å…æœºåˆ¶**ã€**æŒ‰éœ€åŠ è½½**èµ„æºã€å›¢é˜Ÿé—´**å…±äº«èµ„æº**ã€æ•°æ®**è·å–**çš„å¤„ç†ï¼Œä»¥åŠå¯¹ç”¨æˆ·è‰¯å¥½çš„**åŠ è½½çŠ¶æ€**ã€‚æˆ‘ä»¬å°†ä¸€ä¸ªä¸ªè®¨è®ºè¿™äº›ä¸»é¢˜ã€‚

### The Base PrototypeåŸºç¡€åŸå‹

è¿™ä¸ªæ¨¡å‹æ‹–æ‹‰æœºçš„é¡µé¢å°†æä¾›ä»¥ä¸‹ç¤ºä¾‹çš„åŸºç¡€æœåŠ¡ã€‚

å®ƒæä¾›**ç±»å‹é€‰æ‹©**å™¨ä»¥åœ¨ä¸‰ç§ä¸åŒå‹å·ä¹‹é—´åšåˆ‡æ¢ï¼Œåœ¨åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼Œäº§å“çš„å›¾ç‰‡ã€åç§°ã€ä»·æ ¼å’Œå»ºè®®ä¼šå¾—åˆ°ç›¸åº”çš„æ›´æ–°ã€‚å¦å¤–è¿˜æœ‰ä¸€ä¸ª**è´­ä¹°æŒ‰é’®**ï¼Œå¯ä»¥æŠŠå½“å‰é€‰ä¸­çš„å‹å·åŠ åˆ°è´­ç‰©è½¦å†…ï¼Œå¤´éƒ¨çš„**å°è´­ç‰©è½¦**çŠ¶æ€å°†å¾—åˆ°æ›´æ–°ã€‚

![Example 0 - Product Page - Plain JS](microfrontend/model-store-0.gif)

[try in browser](https://micro-frontends.org/0-model-store/) & [inspect the code](https://github.com/neuland/micro-frontends/tree/master/0-model-store)

æ‰€æœ‰çš„HTMLéƒ½æ˜¯ç”¨**çº¯js**å’Œes6çš„æ¨¡æ¿å­—ç¬¦ä¸²ç”Ÿæˆçš„ï¼Œ**æ²¡æœ‰ä¾èµ–**ã€‚ä»£ç ç”¨äº†ä¸€ä¸ªç®€å•çš„çŠ¶æ€/æ ‡è®°åˆ†ç¦»æ–¹å¼ï¼Œåœ¨æ¯æ¬¡æœ‰å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“HTMLå®¢æˆ·ç«¯ï¼Œæ²¡æœ‰èŠ±å“¨çš„DOMå·®å¼‚ï¼Œç°åœ¨ä¹Ÿ**æ²¡æœ‰é€šç”¨çš„æ¸²æŸ“**ã€‚å¹¶ä¸”æ²¡æœ‰**å›¢é˜Ÿåˆ†å‰²**ï¼Œ[the code](https://github.com/neuland/micro-frontends/tree/master/0-model-store)æ˜¯æ”¾åœ¨ä¸€ä¸ªjs/cssæ–‡ä»¶å†…çš„ã€‚

### Clientside Integrationå®¢æˆ·ç«¯é›†æˆ

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé¡µé¢è¢«åˆ†å‰²æˆä¸‰ä¸ªå›¢é˜Ÿè´Ÿè´£çš„ç»„ä»¶/ç‰‡æ®µã€‚**Team Checkout**(è“è‰²)è´Ÿè´£æ‰€æœ‰è´­ä¹°æµç¨‹çš„ä»»åŠ¡-**è´­ä¹°æŒ‰é’®**å’Œ**è¿·ä½ è´­ç‰©è½¦**ã€‚**Team Inspire**ï¼ˆç»¿è‰²ï¼‰è´Ÿè´£äº§å“å»ºè®®ã€‚**Team Product**ï¼ˆçº¢è‰²ï¼‰æ•´ä¸ªäº§å“é¡µé¢å¸ƒå±€ã€‚

![Example 1 - Product Page - Composition](microfrontend/three-teams.png)

> è¯‘è€…æ³¨ï¼šä»å›¾ä¸Šçœ‹å‡ºæ¥ï¼Œä¸åŒçš„éƒ¨åˆ†å¯èƒ½ç”¨ä¸åŒçš„æŠ€æœ¯æ¥å®ç°ã€‚

[try in browser](https://micro-frontends.org/1-composition-client-only/) & [inspect the code](https://github.com/neuland/micro-frontends/tree/master/1-composition-client-only)

**Team Product**å†³å®šå“ªäº›åŠŸèƒ½å°†è¢«åŒ…å«è¿›æ¥ã€å„ä¸ªåŠŸèƒ½è¢«æ”¾åˆ°å“ªä¸ªä½ç½®ã€‚é¡µé¢æœ¬èº«æ‰€åŒ…å«çš„ä¿¡æ¯å¯ä»¥ç”¨**Team Product**æä¾›ï¼Œæ¯”å¦‚äº§å“åç§°ã€å›¾ç‰‡ã€å¯é€‰ç§ç±»ã€‚ä½†æ˜¯å®ƒä¹ŸåŒ…å«äº†ä¸€äº›å…¶ä»–å›¢é˜Ÿå¼€å‘çš„è‡ªå®šä¹‰å…ƒç´ ã€‚

#### How to Create a Custom Element?å¦‚ä½•åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰å…ƒç´ 

è®©æˆ‘ä»¬é€‰**è´­ä¹°æŒ‰é’®**ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œ**Team Product **ç®€å•åœ°é€šè¿‡æŠŠ`<blue-buy sku="t_porsche"></blue-buy>`åŠ åˆ°ç›¸åº”æ ‡ç­¾ä½ç½®å¼•å…¥æŒ‰é’®ã€‚ä¸ºäº†è¿™ç§å¼•ç”¨æ“ä½œï¼Œ**Team Checkout**å¿…é¡»åœ¨é¡µé¢å†…æ³¨å†Œ`blue-buy`ã€‚

```javascript
class BlueBuy extends HTMLElement {
  constructor() {
    super();
    this.innerHTML = `<button type="button">buy for 66,00 â‚¬</button>`;
  }
  disconnectedCallback() { ... }
}
window.customElements.define('blue-buy', BlueBuy);
```

æ³¨å†Œå¥½åï¼Œæ¯æ¬¡æµè§ˆå™¨é‡åˆ°ä¸€ä¸ªæ–°çš„`blue-buy`æ ‡ç­¾ï¼Œæ„é€ å‡½æ•°å°±ä¼šè¢«è°ƒç”¨ã€‚`this`æŒ‡å‘ä½ å®šä¹‰çš„è‡ªå®šä¹‰å…ƒç´ çš„æ ¹ç»“ç‚¹ï¼Œæ‰€æœ‰ç¬¦åˆæ ‡å‡†DOMå…ƒç´ çš„å±æ€§å’Œæ–¹æ³•éƒ½å¯ä»¥è¢«è°ƒç”¨ï¼Œæ¯”å¦‚`innerHTML`å’Œ`getAttribute()`ã€‚

![Custom Element in Action](microfrontend/custom-element.gif)

ä¸ºäº†å…¼å®¹é‚£äº›æ¥ä¸‹æ¥çš„æ–°çš„HTMLæ ‡ç­¾ï¼Œå…ƒç´ å‘½åå”¯ä¸€çš„è§„èŒƒæ€§è¦æ±‚å°±æ˜¯åå­—å¿…é¡»åŒ…å«**çŸ­æ¨ª(dash)`-`**ã€‚åœ¨æ¥ä¸‹æ¥çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ç”¨çš„å‘½åè§„èŒƒä¸º`[team_color]-[feature]`ã€‚å‘½åç©ºé—´çš„æ–¹å¼å¯ä»¥é¿å…å†²çªï¼Œå¹¶ä¸”ç®€å•åœ°çœ‹ä¸€ä¸‹DOMç»“æ„å°±å¯ä»¥æ¸…æ¥šåœ°çŸ¥é“è¿™ä¸ªç‰¹æ€§æ˜¯å“ªä¸ªå›¢é˜Ÿè´Ÿè´£çš„ã€‚

### Parent-Child Communication / DOM Modificationçˆ¶å­ç»„ä»¶é€šä¿¡/DOMä¿®æ”¹

å½“ç”¨åœ¨**ç±»å‹é€‰æ‹©**å†…é€‰æ‹©å¦ä¸€ä¸ªæ‹–æ‹‰æœºæ—¶ï¼Œ**è´­ä¹°æŒ‰é’®**å¿…é¡»ä¾æ­¤æ›´æ–°ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®æ ‡ï¼Œ**Team Product**å¯ä»¥ç®€å•åœ°**ç§»é™¤**å·²å­˜åœ¨çš„DOMå…ƒç´ ï¼Œç„¶å**æ’å…¥**ä¸€ä¸ªæ–°çš„ã€‚

```javascript
container.innerHTML;
// => <blue-buy sku="t_porsche">...</blue-buy>
container.innerHTML = '<blue-buy sku="t_fendt"></blue-buy>';
```

æ—§å…ƒç´ çš„`disconnectedCallback`æ–¹æ³•ï¼Œä¼šåœ¨æ–°åˆ›å»ºçš„`t_fendt`å…ƒç´ çš„`constructorï¼ˆæ„é€ å‡½æ•°ï¼‰è¢«è°ƒç”¨ååŒæ­¥è°ƒç”¨ï¼Œä»¥æä¾›ä¸€ä¸ªæ¸…é™¤èµ„æºçš„æœºä¼šï¼Œæ¯”å¦‚åœ¨è¿™é‡Œæ¸…é™¤äº‹ä»¶ç›‘å¬ã€‚

å¦ä¸€ç§é«˜æ€§èƒ½çš„æ–¹æ³•æ˜¯åªæ›´æ–°å·²å­˜åœ¨å…ƒç´ çš„`sku`å±æ€§ã€‚

```javascript
document.querySelector('blue-buy').setAttribute('sku', 't_fendt');
```

å¦‚æœ**Team Product**ä½¿ç”¨äº†æä¾›DOM diffç‰¹æ€§çš„æ¨¡æ¿å¼•æ“ï¼Œæ¯”å¦‚Reactï¼Œ é‚£è¿™ç§æ›¿æ¢å°†è¢«ç®—æ³•è‡ªåŠ¨å¤„ç†ã€‚

![Custom Element Attribute Change](microfrontend/custom-element-attribute.gif)

ä¸ºäº†æ”¯æŒè¿™ç§ç‰¹æ€§ï¼Œè‡ªå®šä¹‰å…ƒç´ å¯ä»¥å®ç°`attributeChangedCallback`æ–¹æ³•å¹¶æŒ‡å®šä¸€äº›èƒ½å¤Ÿè§¦å‘æ­¤å›è°ƒçš„å±æ€§`observedAttributes`ã€‚

```javascript
const prices = {
  t_porsche: '66,00 â‚¬',
  t_fendt: '54,00 â‚¬',
  t_eicher: '58,00 â‚¬',
};

class BlueBuy extends HTMLElement {
  // æŒ‡å®šå¯è§‚å¯Ÿå±æ€§ï¼Œè¿™äº›å±æ€§å˜åŠ¨åä¼šè§¦å‘attributeChangedCallbackæ–¹æ³•
  static get observedAttributes() {
    return ['sku'];
  }
  // å…ƒç´ åˆ›å»ºæ—¶è°ƒç”¨ã€‚åˆå§‹åŒ–
  constructor() {
    super();
    // åˆå§‹åŒ–æ¸²æŸ“
    this.render();
  }
  // æ¸²æŸ“
  render() {
    const sku = this.getAttribute('sku');
    const price = prices[sku];
    this.innerHTML = `<button type="button">buy for ${price}</button>`;
  }
  // å±æ€§å˜åŠ¨å›è°ƒ
  attributeChangedCallback(attr, oldValue, newValue) {
    // é‡æ–°æ¸²æŸ“
    this.render();
  }
  // å…ƒç´ è¢«é”€æ¯å‰ï¼Œç”±æµè§ˆå™¨è°ƒç”¨
  disconnectedCallback() {...}
}
// å®šä¹‰è‡ªå®šä¹‰å…ƒç´ 
window.customElements.define('blue-buy', BlueBuy);
```

ä¸ºäº†é¿å…é‡å¤å†™ä»£ç ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ª`render`æ–¹æ³•ï¼Œå®ƒå¯ä»¥åœ¨`constructor`å’Œ`attributeChangeCallback`è°ƒç”¨ã€‚è¿™ä¸ªæ–¹æ³•æœé›†æ‰€éœ€çš„æ•°æ®ã€ç”Ÿæˆæ–°çš„innerHTMLã€‚å½“ä½ è€ƒè™‘åœ¨è‡ªå®šä¹‰å…ƒç´ å†…éƒ¨ä½¿ç”¨å¤æ‚çš„æ¨¡æ¿å¼•æ“æˆ–è€…æ¡†æ¶æ—¶ï¼Œrenderå°±æ˜¯å†™ç›¸å…³åˆå§‹åŒ–ä»£ç çš„åœ°æ–¹ã€‚

#### Browser Supportæµè§ˆå™¨æ”¯æŒ

ä¸Šé¢çš„ç¤ºä¾‹é‡‡ç”¨è‡ªå®šä¹‰å…ƒç´ çš„V1ç‰ˆæœ¬çš„è§„èŒƒï¼Œå—åˆ°[supported in Chrome, Safari and Opera](http://caniuse.com/#feat=custom-elementsv1)æ”¯æŒã€‚ä½†æ˜¯ç”¨[document-register-element](https://github.com/WebReflection/document-register-element) ï¼Œå¯ä»¥æœ‰ä¸€ç§è½»é‡çº§çš„ç»è¿‡å®è·µæµ‹è¯•çš„polyfillï¼Œè®©è¿™ä¸ªä¾‹å­åœ¨æ‰€æœ‰æµè§ˆå™¨ä¸­è·‘æˆåŠŸã€‚`document-register-element`é‡‡ç”¨äº†å¹¿å—æ”¯æŒ([widely supported](http://caniuse.com/#feat=mutationobserver) )çš„`Mutation Observer APIï¼Œæ‰€ä»¥åº•å±‚æ²¡æœ‰ç”¨DOMæ ‘æ–¹å¼æ£€æŸ¥ç¨‹åºè¿è¡ŒçŠ¶æ€ã€‚

#### Framework Compatibilityæ¡†æ¶å…¼å®¹æ€§

è‡ªå®šä¹‰å…ƒç´ æ˜¯ä¸€ä¸ªwebæ ‡å‡†ï¼Œä¸»è¦çš„jsæ¡†æ¶(Angularã€Reactã€Preactã€Vueã€Hyperapp)éƒ½æ”¯æŒã€‚ä½†å½“ä½ æ·±å…¥äº†è§£çš„è¯ï¼Œ åœ¨ä¸€äº›æ¡†æ¶ä¸Šè¿˜å­˜åœ¨å°‘é‡å®ç°é—®é¢˜ã€‚[Custom Elements Everywhere](https://custom-elements-everywhere.com/) [Rob Dodson](https://twitter.com/rob_dodson)è¿™ç¯‡æ–‡ç« è®²äº†ä¸€äº›å…¼å®¹æ€§æµ‹è¯•ï¼Œæœªè§£å†³çš„é—®é¢˜è¢«é«˜äº®æ ‡æ˜äº†ã€‚

#### Child-Parent or Siblings Communication / DOM Eventsçˆ¶å­ç»„ä»¶é€šä¿¡ã€å…„å¼Ÿç»„ä»¶é€šä¿¡/DOMäº‹ä»¶

ä¼ é€’å±æ€§ä¸æ˜¯å¯¹æ‰€æœ‰çš„äº¤äº’éƒ½é‚£ä¹ˆæœ‰æ•ˆã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œ**è¿·ä½ è´­ç‰©è½¦éœ€è¦åœ¨ç”¨æˆ·ç‚¹å‡»è´­ä¹°æŒ‰é’®æ—¶å¾—åˆ°åˆ·æ–°**ã€‚è¿™ä¸¤ä¸ªç‰‡æ®µéƒ½è¢«**Team Checkout (blue)**æŒæœ‰ï¼Œæ‰€ä»¥ä»–ä»¬èƒ½å¤Ÿæ„å»ºä¸€äº›å†…éƒ¨çš„js APIæ¥è®©è¿·ä½ è´­ç‰©è½¦çŸ¥é“æŒ‰é’®è¢«ç‚¹å‡»äº†ï¼›ä½†æ˜¯è¿™ç§æ–¹æ³•è®©ä¸¤ä¸ªç»„ä»¶å®ä¾‹éƒ½è¦çŸ¥é“å¯¹æ–¹çš„æ–¹æ³•ï¼Œæ˜¾ç„¶è¿èƒŒäº†ç‹¬ç«‹åˆ†ç¦»çš„åŸåˆ™ã€‚

ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨äº‹ä»¶æ€»çº¿ï¼ˆPubSubï¼‰ï¼Œè¿™æ ·ä¸€ä¸ªç»„ä»¶å¯ä»¥å‘å¸ƒä¸€ä¸ªäº‹ä»¶ï¼Œå…¶ä»–çš„ç»„ä»¶å¯ä»¥è®¢é˜…è¿™ä¸ªäº‹ä»¶ä¸»é¢˜ã€‚å¹¸è¿çš„æ˜¯æµè§ˆå™¨å·²ç»é›†æˆäº†è¿™ä¸ªç‰¹æ€§ï¼Œåƒ`click`ã€`select`æˆ–è€…`mouseover`è¿™äº›äº‹ä»¶å°±æ˜¯è¿™ä¹ˆç”Ÿæ•ˆçš„ã€‚é™¤äº†åˆ©ç”¨æµè§ˆå™¨æœ¬èº«äº‹ä»¶å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨`new CustomEvent()`æ¥åˆ›å»ºæ›´é«˜çº§çš„äº‹ä»¶ã€‚äº‹ä»¶æ€»æ˜¯ç»‘å®šåœ¨åˆ›å»º/åˆ†å‘å®ƒçš„å…ƒç´ ä¸Šï¼Œå¤§å¤šæ•°åŸç”Ÿäº‹ä»¶éƒ½æœ‰å†’æ³¡çš„ç‰¹æ€§ï¼Œè¿™è®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨å…ƒç´ ä¸Šç›‘å¬å­DOMæ ‘ä¸Šçš„äº‹ä»¶ã€‚å¦‚æœä½ æƒ³ç›‘å¬é¡µé¢ä¸Šæ‰€æœ‰çš„äº‹ä»¶ï¼Œå°±æŠŠç›‘å¬äº‹ä»¶æ”¾åˆ°`window`ä¸Šå°±å¯ä»¥äº†ã€‚è¿™é‡Œæˆ‘ç¤ºä¾‹äº†å¦‚ä½•ä½¿ç”¨`blue:basket:changed`äº‹ä»¶ï¼š

```javascript
class BlueBuy extends HTMLElement {
  [...]
  connectedCallback() {
    [...]
    this.render();
    this.firstChild.addEventListener('click', this.addToCart);
  }
  addToCart() {
    // maybe talk to an api
    this.dispatchEvent(new CustomEvent('blue:basket:changed', {
      bubbles: true,
    }));
  }
  render() {
    this.innerHTML = `<button type="button">buy</button>`;
  }
  disconnectedCallback() {
    this.firstChild.removeEventListener('click', this.addToCart);
  }
}
```

è¿·ä½ è´­ç‰©è½¦å¯ä»¥åœ¨`window`ä¸Šè®¢é˜…è¿™ä¸ªäº‹ä»¶ï¼Œå½“å®ƒåº”è¯¥æ›´æ–°çš„æ—¶å€™ï¼Œä¼šå¾—åˆ°å¯¹åº”çš„é€šçŸ¥ã€‚

```javascript
class BlueBasket extends HTMLElement {
  connectedCallback() {
    [...]
    window.addEventListener('blue:basket:changed', this.refresh);
  }
  refresh() {
    // fetch new data and render it
  }
  disconnectedCallback() {
    window.removeEventListener('blue:basket:changed', this.refresh);
  }
}
```

åœ¨è¿™æ®µè¿·ä½ è´­ç‰©è½¦çš„ç‰‡æ®µä¸­ï¼Œå®ƒåœ¨å†…éƒ¨æ·»åŠ äº†å¤–éƒ¨DOMçš„ç›‘å¬äº‹ä»¶ã€‚å¾ˆå¤šåº”ç”¨åœºæ™¯ï¼Œè¿™éƒ½æ˜¯okçš„ï¼Œä½†å¦‚æœä½ è§‰å¾—è¿™ä¹ˆåšä¸å¥½ï¼Œä½ å¯ä»¥å®ç°ä¸€ä¸ªé¡µé¢æœ¬èº«(**Team Product**)çš„äº‹ä»¶ç›‘å¬å’Œé€šçŸ¥å‘å¸ƒæœºåˆ¶ï¼Œå½“éœ€è¦æ›´æ–°çš„æ—¶å€™åœ¨**Team Product**ä¸­è°ƒç”¨`refresh()`æ¥é€šçŸ¥è¿·ä½ è´­ç‰©è½¦ã€‚

```javascript
// page.js
const $ = document.getElementsByTagName;

$('blue-buy')[0].addEventListener('blue:basket:changed', function() {
  // ç›´æ¥è°ƒç”¨è´­ç‰©è½¦çš„refreshæ–¹æ³•
  $('blue-basket')[0].refresh();
});
```

å‘½ä»¤å¼åœ°è°ƒç”¨DOMæ–¹æ³•æ˜¯éå¸¸ç½•è§çš„ï¼Œä½†åœ¨è¿™ä¸ªè§†é¢‘([video element api](https://developer.mozilla.org/de/docs/Web/HTML/Using_HTML5_audio_and_video#Controlling_media_playback) )ä¸­èƒ½æ‰¾åˆ°ç¤ºä¾‹ã€‚å¦‚æœå¯èƒ½åº”ä¼˜å…ˆä½¿ç”¨å£°æ˜å¼çš„æ–¹å¼ã€‚

## Serverside Rendering / Universal RenderingæœåŠ¡ç«¯æ¸²æŸ“/é€šç”¨æ¸²æŸ“

åœ¨æµè§ˆå™¨ä¸­ç”¨è‡ªå®šä¹‰å…ƒç´ çš„æ–¹å¼é›†æˆç»„ä»¶æ˜¯å¾ˆæ£’çš„ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æ˜¯åœ¨æ„å»ºä¸€ä¸ªç½‘ç»œä¸Šçš„webåº”ç”¨æ—¶ï¼Œæœ€é‡è¦çš„æ˜¯é¦–æ¬¡åŠ è½½çš„æ€§èƒ½ï¼Œåœ¨jsæ¡†æ¶åŠ è½½å’Œæ‰§è¡Œå®Œä¹‹å‰ï¼Œç”¨æˆ·å°†é¢å¯¹ä¸€ä¸ªç™½å±çš„é¡µé¢ã€‚å¦å¤–ï¼Œè¦è€ƒè™‘åˆ°jsåŠ è½½å¤±è´¥æˆ–è€…é˜»å¡çš„æƒ…å†µã€‚[Jeremy Keith](https://adactio.com/)åœ¨[Resilient Web Design](https://resilientwebdesign.com/)ä¸­è§£é‡Šäº†è¿™ä¸ªé‡è¦æ€§ã€‚å› æ­¤åœ¨æœåŠ¡ç«¯æ¸²æŸ“æ ¸å¿ƒå†…å®¹æ˜¯ä¸€ä¸ªå…³é”®èƒ½åŠ›ã€‚æ‚²å‚¬çš„æ˜¯webç»„ä»¶æ ‡å‡†æ²¡æœ‰èŠåˆ°æœåŠ¡ç«¯æ¸²æŸ“çš„å†…å®¹ã€‚æ²¡æœ‰jsï¼Œæ²¡æœ‰è‡ªå®šä¹‰å…ƒç´ ğŸ˜¢ã€‚

### Custom Elements + Server Side Includes = â¤ï¸è‡ªå®šä¹‰å…ƒç´ +æœåŠ¡ç«¯æ¸²æŸ“=ğŸ‚ğŸº

ä¸ºäº†æä¾›æœ‰æ•ˆçš„æœåŠ¡ç«¯æ¸²æŸ“ï¼Œå‰é¢çš„ç¤ºä¾‹éœ€è¦é‡å†™ä¸€ä¸‹ã€‚æ¯ä¸ªå›¢é˜Ÿå°†æœ‰ä»–ä»¬è‡ªå·±çš„expressæœåŠ¡ï¼Œå¹¶ä¸”è‡ªå®šä¹‰å…ƒç´ çš„`reander()`æ–¹æ³•å¯ä»¥é€šè¿‡urlå¾—åˆ°ã€‚

```base
$ curl http://127.0.0.1:3000/blue-buy?sku=t_porsche
<button type="button">buy for 66,00 â‚¬</button>
```

ä½¿ç”¨è‡ªå®šä¹‰å…ƒç´ çš„æ ‡ç­¾åä½œä¸ºè·¯å¾„åç§°ï¼Œå±æ€§æˆä¸ºqueryå‚æ•°ã€‚ç°åœ¨å°±å¯ä»¥ç»™ä»»æ„å†…å®¹åšæœåŠ¡ç«¯æ¸²æŸ“äº†ã€‚ç»“åˆ`<blue-buy>`å’Œè‡ªå®šä¹‰å…ƒç´ ï¼Œå°±å¾ˆæ¥è¿‘é€šç”¨æ¸²æŸ“ç»„ä»¶äº†ï¼š

```html
<blue-buy sku="t_porsche">
  <!--#include virtual="/blue-buy?sku=t_porsche" -->
</blue-buy>
```

`#include`æ˜¯æœåŠ¡ç«¯æ¸²æŸ“include([Server Side Includes](https://en.wikipedia.org/wiki/Server_Side_Includes))çš„ä¸€éƒ¨åˆ†ï¼Œå¾ˆå¤šwebæœåŠ¡å™¨éƒ½æ”¯æŒè¿™ç§ç‰¹æ€§ã€‚æ˜¯çš„ï¼Œè¿™ä¸ªæŠ€æœ¯å’Œä»¥å‰ç”¨çš„é‚£ç§åµŒå¥—æŠ€æœ¯æ˜¯ä¸€æ ·çš„ï¼Œå¹¶è¢«ç”¨åœ¨äº†æˆ‘ä»¬ä»Šå¤©çš„ç½‘ç«™ä¸Šã€‚å¦å¤–ä¹Ÿæœ‰å¾ˆå¤šå¯é€‰çš„å…¶ä»–æŠ€æœ¯ï¼Œæ¯”å¦‚ï¼š[ESI](https://en.wikipedia.org/wiki/Edge_Side_Includes), [nodesi](https://github.com/Schibsted-Tech-Polska/nodesi), [compoxure](https://github.com/tes/compoxure) å’Œ [tailor](https://github.com/zalando/tailor)ã€‚ä½†æ˜¯æˆ‘ä»¬é¡¹ç›®çš„æœåŠ¡ç«¯æ¸²æŸ“å·²ç»è¯æ˜äº†è¿™ç§æ–¹æ¡ˆæ˜¯ç®€å•æœ‰æ•ˆçš„äº†ã€‚

`#include`ä¼šåœ¨æœåŠ¡ç«¯å‘æµè§ˆå™¨å‘é€æ•´ä¸ªé¡µé¢ä¹‹å‰è¢«`/blue-buy?sku=t_porsche`æ›¿æ¢æ‰ã€‚`nginx`å¯¹åº”çš„é…ç½®ä¸ºï¼š

```nginx
upstream team_blue {
  server team_blue:3001;
}
upstream team_green {
  server team_green:3002;
}
upstream team_red {
  server team_red:3003;
}

server {
  listen 3000;
  ssi on;

  location /blue {
    proxy_pass  http://team_blue;
  }
  location /green {
    proxy_pass  http://team_green;
  }
  location /red {
    proxy_pass  http://team_red;
  }
  location / {
    proxy_pass  http://team_red;
  }
}
```

ç›´æ¥`ssi:on`ï¼Œå¼€å¯æœåŠ¡ç«¯æ¸²æŸ“åŠŸèƒ½ï¼Œ`upstream`å’Œ`location`å—ä¼šè¢«åŠ è½½æ¥ä¸ºæ¯ä¸ªå›¢é˜ŸæœåŠ¡ï¼Œä»¥ç¡®ä¿æ‰€æœ‰`/blue`å¼€å¤´çš„urléƒ½ä¼šè¢«è·¯ç”±åˆ°æ­£ç¡®çš„åº”ç”¨(`team_blue:3001`)ã€‚`/`è¢«è·¯ç”±åˆ°**Team Product**ï¼ˆredï¼‰ã€‚

ä»¥ä¸‹åŠ¨ç”»å±•ç¤ºäº†**ç¦ç”¨js**åçš„æ‹–æ‹‰æœºå•†åº—(æµè§ˆå™¨ä¸­)ï¼š

> è¯‘è€…æ³¨ï¼šç¿»è¯‘åˆ°è¿™é‡Œï¼Œæˆ‘éœ‡æƒŠäº†

![Serverside Rendering - Disabled JavaScript](microfrontend/server-render.gif)

[inspect the code](https://github.com/neuland/micro-frontends/tree/master/2-composition-universal)

ç±»å‹é€‰æ‹©æŒ‰é’®ç°åœ¨å®é™…ä¸Šæ˜¯é“¾æ¥äº†ï¼Œæ¯ä¸ªç‚¹å‡»éƒ½å°†è¢«é“¾æ¥åˆ°æ–°åŠ è½½çš„é¡µé¢ä¸­ã€‚å³è¾¹çš„ç»ˆç«¯å±•ç¤ºäº†ä¸€ä¸ªè¯·æ±‚æ˜¯å¦‚ä½•è¢«è·¯ç”±åˆ°**Team Product**ï¼ˆredï¼‰çš„ï¼Œè€Œreaæ§åˆ¶é¡µé¢çš„å¸ƒå±€å’Œå±•ç¤ºï¼ŒredåŠ è½½å®Œæˆä¹‹åï¼Œå†…éƒ¨çš„æ ‡è®°å°†ç”±blueå’Œgreenè¡¥å……ã€‚

å½“åˆ‡æ¢å›js enableçš„çŠ¶æ€ï¼Œå°±åªä¼šæœ‰ç¬¬ä¸€ä¸ªè¯·æ±‚æ—¥å¿—ä¼šå±•ç¤ºå‡ºæ¥(åªä¼šå‘ç”Ÿç¬¬ä¸€ä¸ªè¯·æ±‚)ï¼Œå› ä¸ºéšåçš„æ‰€æœ‰æ‹–æ‹‰æœºå˜åŒ–ä¹‹ç±»çš„æ“ä½œéƒ½åœ¨å®¢æˆ·ç«¯è§£å†³äº†(js)ã€‚è¿™ä¸ªä¾‹å­ä¸­äº§å“æ•°æ®ä¼šé¢å¤–åœ°ç”¨REST apiæ¥ä»åç«¯åŠ è½½ã€‚

ä½ å¯ä»¥åœ¨æœ¬åœ°è¿è¡Œè¿™äº›ç®€å•çš„ä»£ç ï¼Œåªéœ€è¦è£…ä¸ªdocker([Docker Compose](https://docs.docker.com/compose/install/))ã€‚

```bash
git clone https://github.com/neuland/micro-frontends.git
cd micro-frontends/2-composition-universal
docker-compose up --build
```

Dockerå¯åŠ¨nginxï¼Œç«¯å£ä¸º3000ï¼Œdockerä¹Ÿå¯ä»¥ä¸ºæ‰€æœ‰å›¢é˜Ÿæ„å»ºnode.jsé•œåƒã€‚å½“ä½ æ‰“å¼€`http://127.0.0.1:300/`ï¼Œä½ åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°ä¸€ä¸ªçº¢è‰²æ‹–æ‹‰æœºã€‚ç»“åˆ`docker-compose`æ’ä»¶å¯ä»¥æ¸…æ¥šåœ°çŸ¥é“ç½‘ç»œä¸Šå‘ç”Ÿäº†ä»€ä¹ˆã€‚æ‚²å‚¬çš„æ˜¯ï¼Œæ²¡åŠæ³•æ§åˆ¶è¾“å‡ºçš„é¢œè‰²ï¼Œæ‰€ä»¥ä½ å¾—å¿å—blueå¯èƒ½è¢«é«˜äº®æˆäº†greenã€‚

`src`æ–‡ä»¶æ˜ å°„åˆ°å•ç‹¬çš„å®¹å™¨ä¸­ï¼Œnodeåº”ç”¨ä¼šåœ¨ä½ æ›´æ–°ä»£ç åé‡å¯ï¼Œæ”¹å˜`nginx.conf`éœ€è¦é‡å¯`docker-compse`ä»¥è·å¾—æ–°çš„ç‰¹æ€§ã€‚é‚£ä¹ˆï¼Œå°½æƒ…äº«ç”¨å§ï¼ŒæœŸå¾…å¾—åˆ°åé¦ˆã€‚

#### Data Fetching & Loading Statesæ•°æ®è·å–å’ŒçŠ¶æ€åŠ è½½

SSI/ESIæ–¹æ³•çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯**æœ€æ…¢çš„ç‰‡æ®µå†³å®šäº†æœ€ç»ˆé¡µé¢çš„å“åº”æ—¶é—´**ã€‚æ‰€ä»¥è¦æ˜¯èƒ½è·å–åˆ°ä¸€ä¸ªç‰‡æ®µçš„å“åº”æ—¶é—´æ˜¯å¾ˆå¥½çš„ï¼Œå¯¹é‚£äº›å¾ˆéš¾äº§ç”Ÿå’Œç¼“å­˜çš„ç‰‡æ®µæ¥è¯´ï¼Œä¸€ä¸ªå¥½çš„æ–¹æ³•å°±æ˜¯æŠŠä»–ä»¬åŒ…æ‹¬åˆ°æœ€åˆçš„æ¸²æŸ“é‡Œé¢ï¼Œä»–ä»¬å¯ä»¥è¢«æµè§ˆå™¨å¼‚æ­¥åŠ è½½ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œ`green-recos`ç‰‡æ®µ(ç”¨æ¥æ¸²æŸ“ä¸ªæ€§åŒ–å»ºè®®çš„)æ˜¯ä¸€ä¸ªå¥½çš„ä¾‹å­ã€‚

ä¸€ç§å¯èƒ½çš„æ–¹å¼å°±æ˜¯redè·³è¿‡æœåŠ¡ç«¯æ¸²æŸ“ã€‚

##### Before

```html
<green-recos sku="t_porsche">
  <!--#include virtual="/green-recos?sku=t_porsche" -->
</green-recos>
```

##### **After**

```html
<green-recos sku="t_porsche"></green-recos>
```

é‡è¦çš„ä¸€ç‚¹ï¼šè‡ªå®šä¹‰å…ƒç´ æ— æ³•è‡ªå…³é—­(*cannot be self-closing*)ï¼Œå› æ­¤å†™æˆ`<green-recos sku="t_porsche" />`ä¸ä¼šç”Ÿæ•ˆã€‚

![Reflow](microfrontend/data-fetching-reflow.gif)

æ¸²æŸ“åªå‘ç”Ÿåœ¨æµè§ˆå™¨ï¼Œä½†æ˜¯ï¼Œåœ¨åŠ¨ç”»ä¸­å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸€å˜åŒ–ç»™é¡µé¢å¸¦æ¥äº†å¤§é‡çš„**é‡æ’**ã€‚å»ºè®®åŒºåŸŸä¸€å¼€å§‹æ˜¯ç™½å±çš„ï¼Œç„¶ågreençš„jsåŠ è½½å’Œæ‰§è¡Œäº†ï¼Œç„¶åæ‰§è¡ŒAPIè·å–å»ºè®®æ•°æ®ï¼Œæœ€åå»ºè®®æ•°æ®çš„æ ‡ç­¾åœ¨è¯·æ±‚å®Œæˆåæ‰æ¸²æŸ“å¥½ï¼Œå¹¶å…³è”åˆ°å¯¹åº”å›¾ç‰‡ä¸Šã€‚è¿™ä¸ªç‰‡æ®µç°åœ¨éœ€è¦æ›´å¤šçš„ç©ºé—´ï¼Œå¹¶ä¸”æŒ¤å‹äº†å¸ƒå±€ã€‚

æœ‰å‡ ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥é¿å…è¿™ç§é‡æ’ã€‚redå¯ä»¥**å›ºå®šå®¹å™¨é«˜åº¦**ï¼Œåœ¨ä¸€ä¸ªå“åº”å¼é¡µé¢ä¸­ï¼Œè¿™ç§æ–¹æ³•æ˜¯ä¸å¯å–çš„ï¼Œå› ä¸ºæ²¡æ³•æ ¹æ®è®¾å¤‡è°ƒæ•´å¸ƒå±€å¤§å°ã€‚ä½†æ˜¯æ›´é‡è¦çš„é—®é¢˜æ˜¯ï¼Œè¿™ç§æ–¹æ³•ä¼šåœ¨redå’Œgreenå›¢é˜Ÿä¹‹é—´å½¢æˆ**ç´§å¯†è”ç³»**ï¼Œè¿™æ˜¯ä¸å¯å–çš„ã€‚

ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨éª¨æ¶å±æ–¹æ¡ˆ[Skeleton Screens](https://blog.prototypr.io/luke-wroblewski-introduced-skeleton-screens-in-2013-through-his-work-on-the-polar-app-later-fd1d32a6a8e7)ã€‚redå›¢é˜Ÿç•™ä¸‹greenå›¢é˜Ÿçš„æœåŠ¡ç«¯æ¸²æŸ“æ ‡è®°ï¼Œgreenå›¢é˜Ÿä¿®æ”¹ä»–ä»¬æœåŠ¡ç«¯æ¸²æŸ“çš„æ–¹æ³•ï¼Œä»¥ä¾¿ç”Ÿæˆéª¨æ¶å±ã€‚éª¨æ¶å±å¯ä»¥é‡å¤ä½¿ç”¨å ç”¨å®é™…æ ‡ç­¾çš„ä½ç½®ï¼Œä»¥é¡µé¢å…äº§ç”Ÿè·³è·ƒçš„æƒ…å†µã€‚

![Skeleton Screen](microfrontend/data-fetching-skeleton.gif)

éª¨æ¶å±åœ¨å®¢æˆ·ç«¯æ¸²æŸ“ä¸­ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ã€‚å½“ä½ çš„è‡ªå®šä¹‰å…ƒç´ æ ¹æ®ç”¨æˆ·æ“ä½œè¦æ’å…¥è¿›DOMæ—¶ï¼Œå®ƒå¯ä»¥ç«‹å³æ¸²æŸ“éª¨æ¶ï¼Œç›´åˆ°æ•°æ®åŠ è½½å®Œæˆåæ¸²æŸ“çœŸå®èŠ‚ç‚¹ã€‚

ç”šè‡³åœ¨å±æ€§åˆ‡æ¢æ—¶ä½ ä¹Ÿå¯ä»¥å†³å®šé¡µé¢åˆ‡æ¢åˆ°éª¨æ¶å±ç›´åˆ°æ–°æ•°æ®çš„åˆ°æ¥ï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥ä»è¿™éƒ¨åˆ†ç‰‡æ®µæ­£åœ¨å‘ç”Ÿçš„äº‹ä¸­è·å¾—æŒ‡ç¤ºã€‚ä½†æ˜¯å½“ä½ çš„ç»ˆç«¯èƒ½å¤Ÿå¿«é€Ÿå“åº”æ—¶ï¼Œå¾ˆå¤šçŸ­æ—¶çš„éª¨æ¶å±é—ªçƒä¹Ÿæ˜¯ä¸€ä¸ªçƒ¦äººçš„äº‹æƒ…ï¼Œä½ éœ€è¦åšä¸€äº›å–èˆã€‚

### Navigating Between Pagesåœ¨é¡µé¢ä¹‹é—´è·³è½¬

æœªå®Œå¾…ç»­...